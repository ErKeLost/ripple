{"version":3,"sources":["../src/options.ts","../src/utils/create-container-element.ts","../src/utils/create-ripple-element.ts","../src/utils/get-element-position-utils.ts","../src/utils/ripple-count.ts","../src/v-ripple.ts","../src/ripple-directive.ts","../index.ts"],"sourcesContent":["interface IRippleDirectiveOptions {\n  /**\n   *\n   * @remarks\n   * Y*  你可以设置 ·currentColor· to 能够自动使用元素的文本颜色\n   *\n   * @default\n   * 'currentColor'\n   */\n  color: string;\n  /**\n   * 第一次出现的透明度\n   *\n   * @default\n   * 0.2 默认opacity 0.2\n   */\n  initialOpacity: number;\n  /**\n   * 在透明度 结束的时候 stopped 的时候 我们设置透明度的大小\n   *\n   * @default\n   * 0.1\n   */\n  finalOpacity: number;\n  /**\n   * 动画持续事件\n   *\n   * @default\n   * 400ms\n   */\n  duration: number;\n  /**\n   * css 动画 从开始到结束 以相同的时间来执行动画\n   *\n   * @default\n   * 'ease-out'\n   */\n  easing: string;\n  /**\n   * 取消延迟时间\n   *\n   * @note\n   * 类似于 debounceTime\n   * @default\n   * 75ms\n   */\n  delay: number;\n  /**\n   * 禁止 水波\n   *\n   * @note\n   * 类似于 点击禁止ripple效果\n   * @default\n   * false\n   */\n  disabled: boolean;\n  /**\n   * ripple展示方式\n   *\n   * @note\n   * ripple在center中间开始动画\n   * @default\n   * false\n   */\n  center: boolean;\n}\n\ninterface IRipplePluginOptions extends IRippleDirectiveOptions {\n  /**\n   * 用于覆盖指令的名称\n   *\n   * @remarks\n   *\n   * @example\n   *\n   * @default\n   * 默认指令 ripple\n   */\n  directive: string;\n}\n\n// 给可预见值 value 添加类型\n\ninterface IRippleDirectiveOptionWithBinding {\n  value: IRippleDirectiveOptions;\n}\n\ninterface HTMLElementRectType {\n  width: number;\n  height: number;\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n}\n\nconst DEFAULT_PLUGIN_OPTIONS: IRipplePluginOptions = {\n  directive: 'ripple',\n  color: 'currentColor',\n  initialOpacity: 0.1,\n  finalOpacity: 0.2,\n  duration: 350,\n  easing: 'ease-out',\n  delay: 60,\n  disabled: false,\n  center: false,\n};\n\nexport { DEFAULT_PLUGIN_OPTIONS, IRipplePluginOptions, HTMLElementRectType, IRippleDirectiveOptions, IRippleDirectiveOptionWithBinding };\n","export const createContainer = ({\n  borderTopLeftRadius,\n  borderTopRightRadius,\n  borderBottomLeftRadius,\n  borderBottomRightRadius\n}: CSSStyleDeclaration): HTMLElement => {\n  const rippleContainer = document.createElement('div');\n  rippleContainer.style.top = '0';\n  rippleContainer.style.left = '0';\n  rippleContainer.style.width = '100%';\n  rippleContainer.style.height = '100%';\n  rippleContainer.style.position = 'absolute';\n  rippleContainer.style.borderRadius =\n  `${borderTopLeftRadius} ${borderTopRightRadius} ${borderBottomRightRadius} ${borderBottomLeftRadius}`;\n  rippleContainer.style.overflow = 'hidden';\n  rippleContainer.style.pointerEvents = 'none';\n  // 兼容 ie  苹果\n  rippleContainer.style.webkitMaskImage = '-webkit-radial-gradient(white, black)';\n\n  return rippleContainer;\n};\n","import { IRippleDirectiveOptions, HTMLElementRectType } from '../options';\n\nexport const createRippleElement = (\n  x: number,\n  y: number,\n  size: number,\n  options: IRippleDirectiveOptions,\n  rect: HTMLElementRectType\n): HTMLElement => {\n  const rippleElement = document.createElement('div');\n  rippleElement.style.position = 'absolute';\n  rippleElement.style.width = options.center ? `${Math.sqrt(rect.width * rect.width + rect.height * rect.height)}px` : `${size * 2}px`;\n  // rippleElement.style.height = options.center ? `${size}px` : `${size}px`;\n  rippleElement.style.height = options.center ? `${Math.sqrt(rect.width * rect.width + rect.height * rect.height)}px` : `${size * 2}px`;\n  rippleElement.style.top = options.center ? `${rect.height / 2}px` : `${y}px`;\n  rippleElement.style.left = options.center ? `${rect.width / 2}px` : `${x}px`;\n\n  rippleElement.style.background = options.color;\n  rippleElement.style.borderRadius = '50%';\n  rippleElement.style.opacity = `${options.initialOpacity}`;\n  rippleElement.style.transform = `translate(-50%,-50%) scale(0)`;\n  rippleElement.style.transition = `transform ${options.duration / 1000}s   cubic-bezier(0, 0.5, 0.25, 1)\n  , opacity ${options.duration / 1000}s\n  cubic-bezier(0.0, 0, 0.2, 1)\n  `;\n  return rippleElement;\n};\n\n// Standard cubic-bezier\n// cubic-bezier(0.0, 0, 0.2, 1)\n","// Pythagorean theorem\nexport function getPythagoreanDistance(x1: number, y1: number, x2: number, y2: number): number {\n  const deltaX = x1 - x2;\n  const deltaY = y1 - y2;\n  return Math.sqrt(deltaX * deltaX + deltaY * deltaY);\n}\n\ninterface DOMRectValue {\n  x: number;\n  y: number;\n  diameter: number;\n}\n// 获取点击目标的位置到块级作用域直线边界的距离\nexport function getDistanceToFurthestCorner(event: PointerEvent, { width, height, left, top }: DOMRect): DOMRectValue {\n  const x = event.clientX - left;\n  const y = event.clientY - top;\n  const topLeft = getPythagoreanDistance(x, y, 0, 0);\n  const topRight = getPythagoreanDistance(x, y, width, 0);\n  const bottomLeft = getPythagoreanDistance(x, y, 0, height);\n  const bottomRight = getPythagoreanDistance(x, y, width, height);\n  const diameter = Math.max(topLeft, topRight, bottomLeft, bottomRight);\n  return {\n    x,\n    y,\n    diameter,\n  };\n}\n","const RIPPLE_COUNT = 'vRippleCountInternal';\nfunction setRippleCount(el: HTMLElement, count: number) {\n  el.dataset[RIPPLE_COUNT] = count.toString();\n}\n\nexport function getRippleCount(el: HTMLElement): number {\n  return parseInt(el.dataset[RIPPLE_COUNT] ?? '0', 10);\n}\n\nexport function incrementRippleCount(el: HTMLElement): void {\n  const count = getRippleCount(el);\n  setRippleCount(el, count + 1);\n}\n\nexport function decrementRippleCount(el: HTMLElement): void {\n  const count = getRippleCount(el);\n  setRippleCount(el, count - 1);\n}\n\nexport function deleteRippleCount(el: HTMLElement): void {\n  delete el.dataset[RIPPLE_COUNT];\n}\n","import { createContainer } from './utils/create-container-element';\nimport { createRippleElement } from './utils/create-ripple-element';\nimport { getDistanceToFurthestCorner } from './utils/get-element-position-utils';\nimport { decrementRippleCount, deleteRippleCount, getRippleCount, incrementRippleCount } from './utils/ripple-count';\nimport { IRippleDirectiveOptions } from './options';\n// Ensure that the current element can be completely overwritten\nconst MULTIPLE_NUMBER = 1.05;\nconst ripple = (event: PointerEvent, el: HTMLElement, options: IRippleDirectiveOptions): void => {\n  // Get Click element\n  const rect = el.getBoundingClientRect();\n  // Get all styles of the currently clicked element\n  const computedStyles = window.getComputedStyle(el);\n  // Get the current mouse click location\n  // 利用勾股定理获取鼠标点击处到el四个角的直线距离， diameter 就是我们点击的位置距离整个el最远的点\n  // const { diameter, x, y } = MULTIPLE_NUMBER * getDistanceToFurthestCorner(event, rect);\n  const { diameter, x, y } = getDistanceToFurthestCorner(event, rect);\n  // Create a hole ripple element 覆盖一个容器在el上面\n  const rippleContainer = createContainer(computedStyles);\n  const rippleEl = createRippleElement(x, y, diameter * MULTIPLE_NUMBER, options, rect);\n  // 原始位置\n  let originalPositionValue = '';\n  // 是否需要移除ripple Do you need to remove ripple\n  let shouldDissolveRipple = false;\n  let token: undefined | number = undefined;\n  // function transform(el: HTMLElement, value: string) {\n  //   el.style.transform = value;\n  // }\n  // remove ripple\n  function dissolveRipple() {\n    rippleEl.style.transition = 'opacity 120ms ease in out';\n    rippleEl.style.opacity = '0';\n    setTimeout(() => {\n      rippleContainer.remove();\n      decrementRippleCount(el);\n      if (getRippleCount(el) === 0) {\n        deleteRippleCount(el);\n        el.style.position = originalPositionValue;\n      }\n    }, 100);\n  }\n  // 释放方法\n  function releaseRipple(e?: PointerEvent) {\n    if (typeof e !== 'undefined') {\n      document.removeEventListener('pointerup', releaseRipple);\n      // document.removeEventListener('pointercancel', releaseRipple);\n    }\n    if (shouldDissolveRipple) {\n      dissolveRipple();\n    } else {\n      shouldDissolveRipple = true;\n    }\n  }\n\n  function cancelRipple(e) {\n    console.log(e);\n    console.log(6666);\n\n    clearTimeout(token);\n    rippleContainer.remove();\n    document.removeEventListener('pointerup', releaseRipple);\n    document.removeEventListener('pointercancel', releaseRipple);\n    document.removeEventListener('pointercancel', cancelRipple);\n  }\n\n  // 设置ripple 的 dataset[RIPPLE_COUNT]\n  incrementRippleCount(el);\n\n  // 给el添加 相对定位 修改 默认值 static\n  if (computedStyles.position === 'static') {\n    if (el.style.position) {\n      originalPositionValue = el.style.position;\n    }\n    el.style.position = 'relative';\n  }\n  // Absolute positioning prevents size overflow and position absolute 修改子元素问题\n  rippleContainer.appendChild(rippleEl);\n  el.appendChild(rippleContainer);\n\n  document.addEventListener('pointerup', releaseRipple);\n  document.addEventListener('pointercancel', releaseRipple);\n\n  token = setTimeout(() => {\n    document.removeEventListener('pointercancel', cancelRipple);\n    rippleEl.style.transform = `translate(-50%,-50%) scale(1)`;\n    rippleEl.style.opacity = `${options.finalOpacity}`;\n    setTimeout(() => releaseRipple(), options.duration);\n  }, options.delay);\n  document.addEventListener('pointercancel', cancelRipple);\n};\n\nexport { ripple };\n","// can export function.  解构参数类型冗余 新定义insterface IRippleDirectiveOptionWithBinding\nimport {\n  DEFAULT_PLUGIN_OPTIONS,\n  IRippleDirectiveOptions,\n  IRippleDirectiveOptionWithBinding\n} from './options';\nimport { ripple } from './v-ripple';\nconst optionMap = new WeakMap<HTMLElement, Partial<IRippleDirectiveOptions> | false>();\nconst globalOptions = { ...DEFAULT_PLUGIN_OPTIONS };\nexport default {\n  mounted(el: HTMLElement, binding: IRippleDirectiveOptionWithBinding): void {\n    optionMap.set(el, binding.value ?? {});\n\n    el.addEventListener('pointerdown', (event) => {\n      const options = optionMap.get(el);\n      // You must make sure that the disabled attribute exists or the instruction terminates with an error\n      if (binding.value && binding.value.disabled) {return;}\n\n      if (options === false) {return;}\n\n      ripple(event, el, {\n        ...globalOptions,\n        ...options\n      });\n    });\n  },\n  updated(el: HTMLElement, binding: IRippleDirectiveOptionWithBinding): void {\n    optionMap.set(el, binding.value ?? {});\n  }\n};\n","import type { App } from 'vue'\nimport RippleDirective from './src/ripple-directive'\n\nexport { RippleDirective }\n\nexport default {\n  title: 'Ripple 水波纹',\n  install(app: App): void {\n    app.directive('Ripple', RippleDirective)\n  }\n}\n"],"mappings":"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","names":[]}